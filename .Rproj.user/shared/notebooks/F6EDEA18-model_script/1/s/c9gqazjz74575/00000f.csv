"0",""
"0","#| message: false"
"0","#| warning: false"
"0",""
"0","#clean sales data"
"0","sales_xy <- st_coordinates(OPA_points)"
"0","ok_sales  <- complete.cases(sales_xy)"
"0","OPA_points <- OPA_points[ok_sales, ]    # keep only rows with valid XY"
"0","sales_xy  <- st_coordinates(OPA_points) # refresh coordinates"
"0",""
"0","transit_xy <- st_coordinates(transit)"
"0","hosp_xy    <- st_coordinates(hospitals)"
"0",""
"0","# feature 1 - distance to nearest transit stop (ft)"
"0","knn_tr <- FNN::get.knnx("
"0","  data  = st_coordinates(transit),"
"0","  query = sales_xy,"
"0","  k = 1)"
"0",""
"0","OPA_points <- OPA_points %>%"
"0","  mutate(dist_nearest_transit_ft = as.numeric(knn_tr$nn.dist[,1]))"
"0",""
"0","# feature 2 - distance to nearest hospital (ft)"
"0","knn_hp <- FNN::get.knnx("
"0","  data  = st_coordinates(hospitals),"
"0","  query = sales_xy,"
"0","  k = 1)"
"0",""
"0","OPA_points <- OPA_points %>%"
"0","  mutate(dist_nearest_hospital_ft = as.numeric(knn_hp$nn.dist[,1]))"
